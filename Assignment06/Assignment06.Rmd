---
title: "Assignment 6"
author: "Your Name Here"
date: '2022-07-24'
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
# Add any packages you want in this chunk:
library(car)
library(gvlma)
```

We are going to look at the property prices for Orange County. From there we are going to try and predict the sales price by linear regression.

# Importing Data 

Bring in the data and make sure the data types are correct. If not, make the proper changes. The file is located within this project. *data/prop_prices_reduced.csv*

```{r}
housing <- read.csv("C:/Users/Ian Ah/Documents/GitHub/ECO5445/Assignment06/data/prop_prices_reduced.csv")
housing$prices_reduced <- housing$sale_def/1000

```


# Plotting

Plot histograms for all variables. Additionally, add scatterplots for the relationships between all quantitative variables.

```{r}
hist(housing$prices_reduced)
hist(housing$bed)
hist(housing$bath)
hist(housing$area_heated)
hist(housing$area)
hist(housing$dist_cbd)
hist(housing$dist_lakes)
hist(housing$pool)

plot(housing$prices_reduced, housing$area_heated)
plot(housing$prices_reduced, housing$bed)
plot(housing$prices_reduced, housing$bath)
plot(housing$prices_reduced, housing$area)
plot(housing$prices_reduced, housing$dist_cbd)
plot(housing$prices_reduced, housing$dist_lakes)
plot(housing$prices_reduced, housing$pool)

scatterplotMatrix(housing,
    main = "Scatterplot Matrix")
```

# Summary Statistics

Provide basic summary statistics for univariate analysis. Also, provide the correlation between all the quantitative variables.

```{r}
summary(housing)
cor(housing)
```

# Regression Analysis

Run a regression with all the variables included. Print results of the regression.

```{r}
Reg <- lm(prices_reduced ~ bed + bath + area_heated + area + dist_cbd + dist_lakes + pool, data = housing)

summary(Reg)

plot(Reg)
```

Which of the variables tested significant at the 95% level? Looking at the results and answering outside of the chunk is sufficient.

Answer: Values that tested significant at the 95% level were sale_def, bed, bath, area_heated, area, dist_cbd, and pool. 

## Evaluating the model

As is, are any of the Gauss-Markov assumptions violated? If so, which ones? How can you fix the issues?

```{r}
# One of the Gauss-Markov assumptions that is violated is the heteroscedastic nature of the data. This can be observed in the plots of relationships between data. It is very clear in the plotting of the housing prices to the area of the lot and the heated area of the home where you can see the fanning out of the points with the increase in x. It also can be observed by running the gvlma test where it does not satisfy the heteroscedasticity test. One way to fix this would be transforming the dependent variable. This can be done with a log transformation to reduce the variability in the data. The homogeneous nature of the data is slightly effected due to the large outliers of observations 37 and 7 which are far outside cooks distance. This can be solved by removing the outliers but that is not recommended. 

gvmodel <- gvlma(Reg)
summary(gvmodel)

```

## New Model

Based off of your findings in the previous section, make changes to the variables, the functional form, etc.

```{r}

Reg2 <- lm(log(prices_reduced) ~ bed + bath + area_heated + area + dist_cbd + log(dist_lakes) + pool, data = housing)
summary(Reg2)
plot(Reg2)

```


# Prediction

Based on the following inputs, predict the deflated sales price:

- 2 bed
- 2 bath
- area_heated = 1223
- area = 9750
- dist_cbd = 19368
- dist_lakes = 490
- no pool

```{r}
housingreg <- data.frame("bed" = 2, "bath" = 2, "area_heated" = 1223, "area" = 9750, "dist_cbd" = 19368, 
                         "dist_lakes" = 490, "pool" = 0)
predict(Reg2, housingreg)
exp(4.7378)*1000

#The price of the home would be $114,183
```
